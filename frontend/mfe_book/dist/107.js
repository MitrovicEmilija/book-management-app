"use strict";(self.webpackChunkmfe_book=self.webpackChunkmfe_book||[]).push([[107],{2107:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var l=a(571),r=a.n(l),o=a(4841),s=a(7536),n=a(5537);function c(){const[e,t]=(0,l.useState)([]),[a,o]=(0,l.useState)([]);return(0,l.useEffect)((()=>{(async()=>{try{const e=(await s.A.get("http://localhost:3000/api/web/books")).data,a=(await s.A.get("http://localhost:3000/api/web/transactions",{params:{page:1,limit:1e3}})).data,l=e.map((e=>{const t=a.filter((t=>t.bookId===e.id)).sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)))[0],l=t&&"RETURN"!==t.transactionType?t.transactionType:"AVAILABLE";return{...e,status:l}}));t(l),o(a)}catch(e){alert("Failed to fetch books or transactions: "+(e.response?.data?.error||e.message))}})()}),[]),r().createElement("div",null,r().createElement("ul",{className:"books-grid"},e.map((e=>r().createElement("li",{key:e.id,className:"book-card"},r().createElement("img",{src:"../public/book.jpeg",alt:`${e.title} cover`,className:"book-image"}),r().createElement("div",{className:"book-details"},r().createElement("h3",null,e.title),r().createElement("p",null,"by ",e.author),r().createElement("p",null,"Status: ",e.status)))))))}function u(){const[e,t]=(0,l.useState)(""),[a,o]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),[m,i]=(0,l.useState)(""),[p,d]=(0,l.useState)(!1),[h,b]=(0,l.useState)(!0);return(0,l.useEffect)((()=>{console.log("CreateBook: Current path:",location.pathname);const e=localStorage.getItem("token");if(e)try{const t=(0,n.s)(e);i(t.sub),d(Array.isArray(t.roles)&&t.roles.includes("ROLE_ADMIN"))}catch(e){console.error("Failed to decode JWT:",e)}b(!1)}),[location.pathname]),h?r().createElement("div",{className:"p-4"},"Loading..."):p?r().createElement("div",{className:"p-4"},r().createElement("h2",{className:"text-xl mb-4"},"Create Book"),r().createElement("form",{onSubmit:async l=>{if(l.preventDefault(),p)try{const l=localStorage.getItem("token");await s.A.post("http://localhost:3000/api/web/books",{title:e,author:a,isbn:c,userId:m},{headers:{Authorization:`Bearer ${l}`}}),alert("Book created"),t(""),o(""),u("")}catch(e){alert("Failed to create book: "+(e.response?.data?.error||e.message))}else alert("Unauthorized: Only admins can create books")},className:"space-y-4"},r().createElement("input",{type:"text",placeholder:"Title",value:e,onChange:e=>t(e.target.value),className:"border p-2 w-full"}),r().createElement("input",{type:"text",placeholder:"Author",value:a,onChange:e=>o(e.target.value),className:"border p-2 w-full"}),r().createElement("input",{type:"text",placeholder:"ISBN",value:c,onChange:e=>u(e.target.value),className:"border p-2 w-full"}),r().createElement("button",{type:"submit",className:"bg-blue-500 text-white p-2"},"Create"))):r().createElement("div",{className:"p-4"},r().createElement("h2",{className:"text-xl mb-4"},"Unauthorized"),r().createElement("p",{className:"text-red-500"},"Only admins can create books."))}const m=function(){return r().createElement(o.Routes,null,r().createElement(o.Route,{path:"/",element:r().createElement(c,null)}),r().createElement(o.Route,{path:"/create",element:r().createElement(u,null)}))}}}]);