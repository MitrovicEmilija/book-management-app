"use strict";(self.webpackChunkmfe_user=self.webpackChunkmfe_user||[]).push([[107],{2107:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var l=a(571),r=a.n(l),s=a(4841),o=a(7536),n=a(5537);function c(){const[e,t]=(0,l.useState)(""),[a,n]=(0,l.useState)(""),c=(0,s.useNavigate)();return r().createElement("div",{className:"p-4"},r().createElement("h2",{className:"text-xl mb-4"},"Login"),r().createElement("form",{onSubmit:async t=>{t.preventDefault();try{const t=(await o.A.post("http://localhost:3000/api/web/users/login",{username:e,password:a})).data.token;console.log("Stored token:",t),localStorage.setItem("token",t),c("/users/dashboard")}catch(e){alert("Login failed: "+(e.response?.data?.error||e.message))}},className:"space-y-4"},r().createElement("input",{type:"text",placeholder:"Username",value:e,onChange:e=>t(e.target.value),className:"border p-2 w-full"}),r().createElement("input",{type:"password",placeholder:"Password",value:a,onChange:e=>n(e.target.value),className:"border p-2 w-full"}),r().createElement("button",{type:"submit",className:"bg-blue-500 text-white p-2"},"Login")),r().createElement("p",{className:"mt-4"},"Don't have an account? ",r().createElement(s.Link,{to:"/users/register",className:"text-blue-500"},"Register here")))}function u(){const[e,t]=(0,l.useState)(""),[a,n]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),m=(0,s.useNavigate)();return r().createElement("div",{className:"p-4"},r().createElement("h2",{className:"text-xl mb-4"},"Register"),r().createElement("form",{onSubmit:async t=>{t.preventDefault();try{await o.A.post("http://localhost:3000/api/web/users/register",{username:e,email:a,password:c,role:"user"}),m("/users/login")}catch(e){alert("Registration failed: "+e.response?.data?.error)}},className:"space-y-4"},r().createElement("input",{type:"text",placeholder:"Username",value:e,onChange:e=>t(e.target.value),className:"border p-2 w-full"}),r().createElement("input",{type:"email",placeholder:"Email",value:a,onChange:e=>n(e.target.value),className:"border p-2 w-full"}),r().createElement("input",{type:"password",placeholder:"Password",value:c,onChange:e=>u(e.target.value),className:"border p-2 w-full"}),r().createElement("button",{type:"submit",className:"bg-blue-500 text-white p-2"},"Register")))}function m(){const[e,t]=(0,l.useState)(null),[a,c]=(0,l.useState)({title:"",author:"",isbn:""}),[u,m]=(0,l.useState)({bookId:"",transactionType:"BORROW"}),i=(0,s.useNavigate)(),p=async()=>{try{const e=localStorage.getItem("token");if(console.log("Raw token:",e),!e)throw new Error("No token found");const a=(0,n.s)(e);console.log("Decoded JWT:",a);const l=a.sub;console.log("User ID:",l);const r=`Bearer ${e}`;console.log("Authorization header:",r);const s=await o.A.get(`http://localhost:3000/api/web/dashboard/${l}`,{headers:{Authorization:r}});t(s.data)}catch(e){alert("Failed to fetch dashboard: "+(e.response?.data?.error||e.message)),i("/users/login")}};return r().createElement("div",{className:"p-4"},r().createElement("h2",{className:"text-xl mb-4"},"Dashboard"),r().createElement("button",{onClick:p,className:"bg-blue-500 text-white p-2 mb-4"},"Load Dashboard"),r().createElement("div",{className:"mb-6"},r().createElement("h3",{className:"text-lg mb-2"},"Add New Book"),r().createElement("form",{onSubmit:async e=>{e.preventDefault();try{const e=localStorage.getItem("token"),t=(0,n.s)(e).sub;await o.A.post("http://localhost:3000/api/web/books",{...a,userId:t},{headers:{Authorization:`Bearer ${e}`}}),alert("Book added successfully"),c({title:"",author:"",isbn:""}),p()}catch(e){alert("Failed to add book: "+(e.response?.data?.error||e.message))}},className:"space-y-4"},r().createElement("input",{type:"text",placeholder:"Title",value:a.title,onChange:e=>c({...a,title:e.target.value}),className:"border p-2 w-full"}),r().createElement("input",{type:"text",placeholder:"Author",value:a.author,onChange:e=>c({...a,author:e.target.value}),className:"border p-2 w-full"}),r().createElement("input",{type:"text",placeholder:"ISBN",value:a.isbn,onChange:e=>c({...a,isbn:e.target.value}),className:"border p-2 w-full"}),r().createElement("button",{type:"submit",className:"bg-blue-500 text-white p-2"},"Add Book"))),r().createElement("div",{className:"mb-6"},r().createElement("h3",{className:"text-lg mb-2"},"Create Transaction"),r().createElement("form",{onSubmit:async e=>{e.preventDefault();try{const e=localStorage.getItem("token"),t=(0,n.s)(e).sub;await o.A.post("http://localhost:3000/api/web/transactions",{userId:t,bookId:u.bookId,transactionType:u.transactionType},{headers:{Authorization:`Bearer ${e}`}}),alert("Transaction created successfully"),m({bookId:"",transactionType:"BORROW"}),p()}catch(e){alert("Failed to create transaction: "+(e.response?.data?.error||e.message))}},className:"space-y-4"},r().createElement("input",{type:"text",placeholder:"Book ID",value:u.bookId,onChange:e=>m({...u,bookId:e.target.value}),className:"border p-2 w-full"}),r().createElement("select",{value:u.transactionType,onChange:e=>m({...u,transactionType:e.target.value}),className:"border p-2 w-full"},r().createElement("option",{value:"BORROW"},"Borrow"),r().createElement("option",{value:"PURCHASE"},"Purchase"),r().createElement("option",{value:"RETURN"},"Return")),r().createElement("button",{type:"submit",className:"bg-blue-500 text-white p-2"},"Create Transaction"))),e&&r().createElement("div",null,r().createElement("h3",null,"User: ",e.user?.username),r().createElement("h4",null,"Books:"),r().createElement("ul",null,e.books.map((e=>r().createElement("li",{key:e.id,className:"mb-2 flex justify-between items-center"},r().createElement("span",null,"ID: ",e.id," - ",e.title," by ",e.author),r().createElement("button",{onClick:()=>(async e=>{try{const t=localStorage.getItem("token");await o.A.delete(`http://localhost:3000/api/web/books/${e}`,{headers:{Authorization:`Bearer ${t}`}}),alert("Book deleted successfully"),p()}catch(e){alert("Failed to delete book: "+(e.response?.data?.error||e.message))}})(e.id),className:"bg-red-500 text-white p-1 rounded"},"Delete"))))),r().createElement("h4",null,"Transactions:"),r().createElement("ul",null,e.transactions.map((e=>r().createElement("li",{key:e.id,className:"mb-2"},e.transactionType," - Book ID: ",e.bookId))))))}const i=function(){return r().createElement(s.Routes,null,r().createElement(s.Route,{path:"/login",element:r().createElement(c,null)}),r().createElement(s.Route,{path:"/register",element:r().createElement(u,null)}),r().createElement(s.Route,{path:"/dashboard",element:r().createElement(m,null)}),r().createElement(s.Route,{path:"/",element:r().createElement(c,null)}))}}}]);